<div id="wrapper">
	
	<div class="animated fadeInRight">
		<div class="col-lg-10 col-lg-offset-1" style="margin-top:100px;">
			<h1><%=currency.toUpperCase()%></h1>
		</div>
		<div class="col-lg-10 col-lg-offset-1" style="margin-top:10px;">
			<ul class="nav nav-tabs">
				<li class="active">
					<a data-toggle="tab" href="#markets">Markets</a>
				</li>
				<li>
					<a data-toggle="tab" href="#history">History</a>
				</li>
				<li>
					<a data-toggle="tab" href="#charts">Charts</a>
				</li>
			</ul>	
			<div class="tab-content" style="margin-top:20px;">
				<div class="tab-pane active" id="markets">
					<%markets.forEach(function(coins){%>
						<div class="table-responsive">
							<!--<h1><%=coins.currency%></h1>-->
							<table class="table table-striped table-bordered table-hover">
							<thead>
							<tr>
								<th>#</th>
								<th>Volume (24h)</th>
								<th>Currency</th>
								<th>Price</th>
								<th>Source</th>
							</tr>
							</thead>
							<tbody>
							<%coins.data.forEach(function(volume,index){%>
							<tr>
								<td><%=index+1%></td>
								<td><%=Math.round(volume.volume)%></td>
								<td><%=volume.currency%></td>
								<td><%=parseFloat(volume.price).toFixed(5)%></td>
								<td><a href="/exchange/<%=volume.src.toLowerCase()%>"><%=volume.src%></a></td>
							</tr>
							<%});%>
							</tbody>
							</table>
						</div>	
					<%});%>
				</div>
				<div class="tab-pane" id="history">
					<div class="table-responsive">
						<table class="table table-striped table-bordered table-hover">
						<thead>
						<tr>
							<th>#</th>
							<th>Price</th>
							<th>High</th>
							<th>Low</th>
							<th>Volume (24h)</th>
							<th>Date</th>
						</tr>
						</thead>
						<tbody>
						<%history.forEach(function(data,index){%>
						<tr>
							<td><%=index+1%></td>
							<td><%=parseFloat(data.price).toFixed(8)%> <%=data.quote_currency.toUpperCase()%></td>
							<td><%=parseFloat(data.high).toFixed(8)%> <%=data.quote_currency.toUpperCase()%></td>
							<td><%=parseFloat(data.low).toFixed(8)%> <%=data.quote_currency.toUpperCase()%></td>
							<td><%=Math.round(data.volume)%></td>
							<td><%=data.data_date%></td>
						</tr>
						<%});%>
						</tbody>
						</table>
					</div>	
				</div>
				<div class="tab-pane" id="charts">
					<div class="table-responsive">
						<table class="table table-striped table-bordered table-hover">
						<thead>
						<tr>
							<th>#</th>
							<th>Pair</th>
							<th>Chart</th>
							<th>Date</th>
						</tr>
						</thead>
						<tbody id="history_chart">
						<%history.forEach(function(data,index){%>
						<tr id="<%=data.product%>">
							<td><%=index+1%></td>
							<td><%=data.product.toUpperCase()%></td>
							<td>
							<div class="row">
								<div class="col-md-12" id="chart_<%=data.product%>"><input type="hidden" id="hidden_<%=data.product%>" value="<%=data.chart%>" />
								</div>
							</div>
							</td>
							<td><%=data.data_date%></td>
						</tr>
						<%});%>
						</tbody>
						</table>
					</div>	
				</div>
			</div>	
		</div>	
	</div>
	
</div>
<script>
$(document).ready(function(){
	$('.table').DataTable({
		pageLength: 10,
		lengthMenu: [[10, 25, 50, -1], [10, 25, 50, 'All']],
		responsive: true,
		dom: '<"html5buttons"B>lTfgitp',
		aoColumnDefs: [{
			'bSortable': false,
			'aTargets': [0] 
		}],
		order: [],
		buttons: [
			//{extend: 'copy'},
			{extend: 'csv'},
			{extend: 'excel', title: 'ExampleFile'},
			{extend: 'pdf', title: 'ExampleFile'},

			//{extend: 'print',
			 //customize: function (win){
				//$(win.document.body).addClass('white-bg');
				//$(win.document.body).css('font-size', '10px');
				//$(win.document.body).find('table').addClass('compact').css('font-size', 'inherit');
			//}
			//}
		],
		drawCallback: function(){ 
			$(this, this.api().table().container()).on('search.dt', function(){
				draw_chart();
			});
			$('.paginate_button', this.api().table().container()).on('click', function(){
				draw_chart();
			});       
		}
	});
	draw_chart();
});

function draw_chart(){
	$("#history_chart").children('tr').each(function(){ 
		var val=$("#hidden_"+this.id).val();
		if(val){
			$("#chart_"+this.id).html('');
			$("#chart_"+this.id).sparkline(val.split(","), {type: 'line',width: '100%',height: '20',lineColor: '#1ab394',fillColor: "transparent"});
		}
	});
}
</script>

